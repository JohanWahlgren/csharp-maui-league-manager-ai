<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:vt25_sysb24_it_client_csharp_vt25_sysb24_booligans.MauiClient.ViewModels"
             x:Class="vt25_sysb24_it_client_csharp_vt25_sysb24_booligans.MauiClient.Pages.PlayersPage"
             x:Name="playersPage"
             Title="Players Directory">

    <ScrollView>
        <Grid>
            <VerticalStackLayout Padding="30"
                                 Spacing="10">
                <!-- SearchBar for filtering players -->
                <Frame Padding="0"
                       BorderColor="#cccccc"
                       CornerRadius="5"
                       HasShadow="False">
                    <SearchBar Placeholder="Search by player number (e.g. P11)"
                               Text="{Binding SearchText}"
                               SearchCommand="{Binding SearchCommand}"
                               SearchCommandParameter="{Binding SearchText}"
                               HorizontalOptions="Fill"
                               BackgroundColor="White"
                               TextColor="#333333"
                               PlaceholderColor="#888888"
                               CancelButtonColor="#555555"/>
                </Frame>

                <!-- Sort buttons -->
                <Label Text="Sort by:"
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                <HorizontalStackLayout Spacing="10"
                                       HorizontalOptions="Start">
                    <Button Text="Team"
                            Command="{Binding SortByTeamCommand}"
                            BackgroundColor="{Binding TeamSortButtonColor}"
                            WidthRequest="100"
                            HeightRequest="40"
                            CornerRadius="5"
                            Margin="0,0,5,0"/>
                    <Button Text="Last Name"
                            Command="{Binding SortByLastNameCommand}"
                            BackgroundColor="{Binding LastNameSortButtonColor}"
                            WidthRequest="100"
                            HeightRequest="40"
                            CornerRadius="5"
                            Margin="0,0,5,0"/>
                    <Button Text="First Name"
                            Command="{Binding SortByFirstNameCommand}"
                            BackgroundColor="{Binding FirstNameSortButtonColor}"
                            WidthRequest="100"
                            HeightRequest="40"
                            CornerRadius="5"
                            Margin="0,0,5,0"/>
                    <Button Text="Player Number"
                            Command="{Binding SortByNumberCommand}"
                            BackgroundColor="{Binding NumberSortButtonColor}"
                            WidthRequest="140"
                            HeightRequest="40"
                            CornerRadius="5"/>
                </HorizontalStackLayout>

                <!-- Activity indicator -->
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   IsVisible="{Binding IsLoading}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   Margin="0,20,0,0"/>
                
                <!-- "No Results" message - Separate from CollectionView -->
                <VerticalStackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Margin="0,40,0,0"
                                     IsVisible="{Binding ShowNoSearchResults}">
                    <Label Text="No search results found"
                           FontSize="18"
                           HorizontalOptions="Center"/>
                    <Label Text="Please try a different search criteria"
                           FontSize="14"
                           TextColor="#666666"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <!-- Players CollectionView - WITHOUT EmptyView -->
                <CollectionView x:Name="PlayersCollection"
                                ItemsSource="{Binding PlayerGroups}"
                                IsGrouped="True"
                                Margin="0,20,0,0">

                    <CollectionView.GroupHeaderTemplate>
                        <DataTemplate>
                            <StackLayout BackgroundColor="#f0f0f0"
                                         Padding="10">
                                <Label Text="{Binding GroupHeaderText}"
                                       FontSize="Medium"
                                       FontAttributes="Bold"/>
                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.GroupHeaderTemplate>

                    <!-- SINGLE ItemTemplate with GestureRecognizer -->
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="5"
                                   Padding="10"
                                   CornerRadius="5"
                                   BorderColor="#cccccc">
                                <Grid Padding="10"
                                      ColumnSpacing="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Name and Number -->
                                    <Label Text="Player Name:"
                                           Grid.Column="0"
                                           Grid.Row="0"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1"
                                           Grid.Row="0"
                                           FontSize="Medium"
                                           VerticalOptions="Center">
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0} {1}">
                                                <Binding Path="FirstName"/>
                                                <Binding Path="LastName"/>
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>

                                    <!-- Player Number -->
                                    <Label Text="Player Number:"
                                           Grid.Column="0"
                                           Grid.Row="1"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                    <Label Text="{Binding PlayerNo}"
                                           Grid.Column="1"
                                           Grid.Row="1"
                                           FontSize="Medium"
                                           VerticalOptions="Center"/>

                                    <!-- Position -->
                                    <Label Text="Position:"
                                           Grid.Column="0"
                                           Grid.Row="2"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                    <Label Text="{Binding Position}"
                                           Grid.Column="1"
                                           Grid.Row="2"
                                           FontSize="Medium"
                                           VerticalOptions="Center"/>

                                    <!-- Shirt Number -->
                                    <Label Text="Shirt #:"
                                           Grid.Column="2"
                                           Grid.Row="0"
                                           FontAttributes="Bold"
                                           FontSize="Small"
                                           HorizontalOptions="End"
                                           VerticalOptions="Center"/>
                                    <Label Text="{Binding PlayerShirtNo}"
                                           Grid.Column="2"
                                           Grid.Row="1"
                                           FontAttributes="Bold"
                                           FontSize="Large"
                                           HorizontalOptions="End"
                                           VerticalOptions="Center"
                                           TextColor="#0078D7"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Grid>
    </ScrollView>
</ContentPage>